var songs = [
    {
        name: "Hada Y2ella - حدا يقلا",
        source: "assets/audio/Hada_Y2ella.mp3",
    },
    {
        name: "Matrah Ma Tnami - مطرح ما تنامي",
        source: "assets/audio/Matrah_Ma_Tnami.mp3",
    },
    {
        name: "Waat El Jadd - وقت الجد",
        source: "assets/audio/Waat_El_Jadd.mp3",
    },
    {
        name: "Shayef Ya Albi - شايف يا قلبي",
        source: "assets/audio/Shayef_Ya_Albi.mp3",
    }
]

var videos = [
    {
        image: "assets/img/videos/Hada_Y2ella.jpg",
        name: "Hada Y2ella -  حدا يقلا",
        source: "https://youtu.be/JadTeiIRQ1E?si=FlPNhFh_lobtu7uB"
    },
    {
        image: "assets/img/videos/Matrah_Ma_Tnami.jpg",
        name: "Matrah Ma Tnami - مطرح ما تنامي",
        source: "https://youtu.be/Haj_BY3e3g0?si=6OIyoiVG8R2fr6-G"
    },
    {
        image: "assets/img/videos/Waet_El_Gadd.jpg",
        name: "Waat El Jadd - وقت الجد",
        source: "https://youtu.be/ycqyd0o-fOI?si=FBYAx-HufgwfBEMd"
    },
    {
        image: "assets/img/videos/Shayef_Ya_Albi.jpg",
        name: "Shayef Ya Albi - شايف يا قلبي",
        source: "https://youtu.be/wzRzZj9D23U?si=xN09Gp4xcilzW9jT"
    },
];

var projects = [
    {
        projectImg: "assets/projects/CarlosAzar/cover.jpg",
        song: {
            artist: "Carlos Azar",
            name: "Kel Ma Bdeelik - كل ما بدقلك",
            source: "assets/projects/CarlosAzar/Kel_Ma_Bdeelik.mp3",
        },
        lyrics: "شو حكيولك عنّي <br> اوعا تكوني صدّقتي <br> صاير عم بغفا <br> وبوعا على صوتك انتِ <br> أنا كل ما بدقلّك <br> تقلّك شو اشتقتلّك <br> ما ردَّيتي قبل الدقّة <br> بحسّك طوَّلتي <br> أنتِ بقلبي وفكري <br> ولا لحظة تفتكري <br> إنّك بتغيبي عن بالي <br> يا حياتي انتِ <br> مين لِحطَّلك براسك <br> إني ناسيكي <br> أنا وقت لِبنساكي بكون <br> عم فكِّر فيكي <br> وبتخيَّل وجّك قدامي <br> وع ايديي عم بتنامي <br> وأنا قاعد هالليل بطولو <br> عم غنّج فيكي",
        arabicLyrics: true,
        story: "This composition is a deeply personal reflection of my inner world, a journey into memories filled with drama, nostalgia, and emotion. The lyrics convey raw and authentic feelings so I wanted the music to echo that same authenticity. <br> In this piece, we took a step back from digital production and recorded the instrumental track live. Each instrument, played in real-time, brought an emotional depth that simply couldn't be achieved otherwise. The result is a composition that feels as genuine and heartfelt as the moments it reflects, letting the listener feel every note and lyric with a unique intimacy.",
        cover: "assets/projects/CarlosAzar/image.jpg",
        releaseDate: "June 8, 2023",
        lyricsBy: "Mounir Bou Assaf",
        composer: "Raphael Jabbour",
        musicArrangement: "Alexandre Missakian",
        mixAndMastering: "Jean Pierre Boutros",
        studio: "Play Sound Studios",
        digitalDistribution: "Youmusic Arabia",
    },
    {
        projectImg: "assets/projects/Cybelle/cover.jpg",
        song: {
            artist: "Cybelle",
            name: "Aala Mazajou - على مزاجو",
            source: "assets/projects/Cybelle/Aala_Mazajou.mp3",
        },
        lyrics: "صاير على مزاجو قلبي عم بدق وإن ما شافك يا حبيبي عليي صار ينق <br> صاير على مزاجو قلبي عم بدق وإن ما شافك يا حبيبي عليي صار ينق <br><br> بدو ياك بدو تبقى على طول حدو وغيرك إنت ما عندو <br> ما عندو ما عندو ما عندو <br> بدو ياك بدو تبقى على طول حدو وغيرك إنت ما عندو <br> ما عندو ما عندو ما عندو <br> صاير على مزاجو قلبي عم بدق <br><br> يا لا لا لا لا لا لا لا <br> يا لا لا لا لا لا لا لا <br><br> كل ما بسمع غنية قلبي بذكرني فيك بلاقي حالي كل شوية من دون قصدي عم بحكيك <br> كل ما بسمع غنية قلبي بذكرني فيك بلاقي حالي كل شوية من دون قصدي عم بحكيك <br><br> بدو ياك بدو تبقى على طول حدو وغيرك إنت ما عندو <br> ما عندو ما عندو ما عندو <br> بدو ياك بدو تبقى على طول حدو وغيرك إنت ما عندو <br> ما عندو ما عندو ما عندو <br> صاير على مزاجو قلبي عم بدق",
        arabicLyrics: true,
        story: "This song came straight from my heart, inspired by the beautiful moments of love. I wanted to capture the essence of romance and the emotions that come with being with someone special. The lyrics reflect a common experience— the internal struggle between the heart and the mind at the start of a relationship, where the heart ultimately wins. I paired these words with a groovy melody that invites you to dance. The simplicity of the lyrics led me to create a catchy, straightforward melodic sequence, and I made sure to keep the arrangement minimal, allowing each instrument to contribute without overpowering the essence of the song.",
        cover: "assets/projects/Cybelle/image.jpg",
        releaseDate: "September 6, 2023",
        lyricsBy: "Raphael Jabbour",
        composer: "Raphael Jabbour",
        musicArrangement: "Maroun Yammine",
        mixAndMastering: "Jean Pierre Boutros",
        studio: "Play Sound Studio",
        digitalDistribution: "Watary",
    },
    {
        projectImg: "assets/projects/HadiDaou/cover.jpg",
        song: {
            artist: "Hadi Daou",
            name: "Mesh Aam Beqdar - مش عم بقدر",
            source: "assets/projects/HadiDaou/Mesh_Aam_Beqdar.mp3",
        },
        lyrics: "عم فتّش فيها عليكِ <br> حتى لاقيكي فيا <br> عم بتخايل عينيكِ <br> كلما بتطلّع فيا <br> وباخدها لنفس المطارح <br> يللّي كنا نروحا مبارح <br> ببقى حدها لكن سارح <br> فيكي ومش حاسس فيا <br><br> مش عم بقدر انسى انّي <br> بحبك انتي وشيلك منّي <br> مش ب ايدي غصبن عني <br> عم صير بإسمك ناديا <br><br> عم جرّب  إلهي حالي <br> مع وحدة غيرِك إعشقا <br> وجرّب إمحيكي من بالي <br> تا حتى إنساكي بَقا <br> بس يلي عرفتا شو ذنبا <br> أظلمها وإجرح قلبا <br> ما زالِك انتي للي بحبّا <br> مش لازم فَكّر فِيا <br><br> مش عم بقدر انسى انّي <br> بحبك انتي وشيلك منّي <br> مش ب ايدي غصبن عني <br> عم صير بإسمك ناديا",
        arabicLyrics: true,
        story: "This track is full of energy, groove and movement. I made sure to include an oriental twist that reflects my roots. <br> While creating it, I imagined how I could melt all of these ideas together. I blended the rhythm and the melodies into one vibrant flow that feels both familiar and fresh. <br> Taking into consideration the unique character of hadi daou, I made sure to create a track that matches his style and live performances.",
        cover: "assets/projects/HadiDaou/image.jpg",
        releaseDate: "June 24, 2022",
        lyricsBy: "Mounir Bou Assaf",
        composer: "Raphael Jabbour",
        musicArrangement: "Georges Kassis",
        mixAndMastering: "Alexandre Missakian",
        digitalDistribution: "Watary",
    },
    {
        projectImg: "assets/projects/NajiOsta/cover.jpg",
        song: {
            artist: "Naji Osta",
            name: "Jiti Mn El Bahr - جيتي من البحر",
            source: "assets/projects/NajiOsta/Jiti_Mn_El_Bahr.mp3",
        },
        lyrics: "جيتي من البحر لونِك شو حلو <br> مسكوبِه الشمس عا جسمِك دخلو ما أجملو <br> شو فيكي سحر وشو زدتي حلا <br> حتى ملح البحر عليكي طعمو حلو <br><br> جيتي من البحر لونِك شو حلو <br> مسكوبِه الشمس عا جسمِك دخلو ما أجملو <br> شو فيكي سحر وشو زدتي حلا <br> حتى ملح البحر عليكي طعمو حلو <br><br> شو صار وضعي صعب ما عاد عندي قلب <br> شو صار وضعي صعب ما عاد عندي قلب <br> يقدر يتحمّل جمالِك ما بحمِلو <br> شو صار وضعي صعب ما عاد عندي قلب <br> يقدر يتحمّل جمالِك <br> (يقبرني الحلو) <br><br> لو رحتي بكرا خِديني معك <br> أنا ما بدي وجّع راسي <br> وبالي إشغِلو <br> خايف شي حدا <br> كلمة يسَمِّعِك <br> ويفكِّر يتغزَّل فيكي <br> يمكن بِقتِلو <br><br> شو صار وضعي صعب ما عاد عندي قلب <br> شو صار وضعي صعب ما عاد عندي قلب <br> يقدر يتحمّل جمالِك ما بحمِلو <br> شو صار وضعي صعب ما عاد عندي قلب <br> يقدر يتحمّل جمالِك <br> (يقبرني الحلو)",
        arabicLyrics: true,
        story: "This song is inspired by the vibrant spirit of summer where the man is playfully flirting with his mistress. <br> The melody is light and playful. I wanted the music to feel like a soundtrack to a day at the beach, easy to enjoy, with a rhythm that flows as naturally as the waves. <br> The whole song has a sunny vibe that makes you feel the warmth of the season while still hitting at the complexity of their connection.",
        cover: "assets/projects/NajiOsta/image.jpg",
        releaseDate: "July 6, 2023",
        lyricsBy: "Mounir Bou Assaf",
        composer: "Raphael Jabbour",
        musicArrangement: "Mounir Bou Assaf",
        digitalDistribution: "Watary",
    },
];

var gallery = [
    "assets/img/pictures/012A1864.jpg",
    "assets/img/pictures/012A2267.jpg",
    "assets/img/pictures/012A2224.jpg",
    "assets/img/pictures/012A1817.jpg",
    "assets/img/pictures/012A1845.jpg",
    "assets/img/pictures/012A2306.jpg",
    "assets/img/pictures/012A2054.jpg",
    "assets/img/pictures/012A2022.jpg",
];

const app = Vue.createApp({
    data() {
        return {
            isLoading: true,
            page: "home",
            windowWidth: window.innerWidth,
            scrollPosition: 0,
            sectionOffsets: {},
            songs: songs,
            currentSong: songs[0],
            currentSongIndex: 0,
            videos: videos,
            projects: projects,
            gallery: gallery,
            playClicked: false,
            listShow: false,
            time: "0:00",
            total: "0:00",
            videosFade: false,
            projectsFade: false,
            picturesFade: false,
            imageIndex: null,
            showModal: false,
            projectIndex: 1,
            projectSelected: projects[1],
            openMobileMenu: false,
        };
    },
    mounted() {
        window.vueApp = this;

        emailjs.init("hEECLLd91lIDSQBLz");

        $("html, body").animate({
            scrollTop: 0
        }, 500);

        window.addEventListener("resize", this.updateWindowWidth);
        window.addEventListener("resize", this.updateSectionOffsets);
        window.addEventListener("scroll", this.scrollTop);
        window.addEventListener("scroll", this.scrollFade);
        window.addEventListener("scroll", this.parallaxEffect);
        window.addEventListener("click", this.handleMenu);

        this.setHeight();
        this.updateSectionOffsets();
        this.setDurations();

        const audio = $("#currentTrack");
        audio.on("loadedmetadata", () => this.updateDuration());
        audio.on("timeupdate", () => this.updateTime());
        audio.on("ended", () => this.handleAudioEnded());
        
        const today = new Date();
        $("footer #date").html(today.getFullYear());

        setTimeout(() => {
            this.isLoading = false;
            $("#music .logo").addClass("fade");
        }, 2000);
    },
    methods: {
        setHeight() {
            $("#music").css("height", $(window).height() + "px");
        },
        setDurations() {
            for (let index = 0; index < songs.length; index++) {
                const track = $(`#track${index + 1}`);
                track.on("loadedmetadata", () => {
                    const duration = track[0].duration;
                    const minutes = Math.floor(duration / 60);
                    const seconds = Math.floor(duration % 60);
                    const time = $(`#time${index + 1}`);
                    time.html(`${minutes}:${seconds < 10 ? "0" : ""}${seconds}`);
                });
            }
        },        
        updateDuration(project = false) {
            var audio;
            if (!project) {
                audio = $("#currentTrack");
            } else {
                audio = $("#projectTrack");
            }
            const duration = audio[0].duration;
            const minutes = Math.floor(duration / 60);
            const seconds = Math.floor(duration % 60);
            if (!project) {
                this.time = `${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
            } else {
                this.total = `${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
            }
        },
        slideMenu() {
            this.openMobileMenu = true;
        },
        closeMenu() {
            this.openMobileMenu = false;
        },
        goToSection(name) {
            const targetElement = `#${name}`;
            $("html, body").animate({
                scrollTop: $(targetElement).offset().top - 55
            }, 1500);

            if (this.windowWidth <= 767) {
                this.openMobileMenu = false;
            }
        },
        goHome(scrollToProject = false) {
            this.isLoading = true;
            this.playClicked = false;

            setTimeout(() => {
                this.page = "home";
                if (!scrollToProject) {
                    $("html, body").animate({
                        scrollTop: 0
                    }, 100);
                }
            }, 250)
            
            setTimeout(() => {
                this.setHeight();
                this.updateSectionOffsets();
                this.setDurations();
                if (scrollToProject) {
                    $("html, body").animate({
                        scrollTop: $("#projects").offset().top - 55
                    }, 100);
                }
            }, 500)

            setTimeout(() => {
                this.isLoading = false;
                $("#music .logo").addClass("fade");
                const audio = $("#currentTrack");
                audio.on("loadedmetadata", () => this.updateDuration());
                audio.on("timeupdate", () => this.updateTime());
                audio.on("ended", () => this.handleAudioEnded());
                audio[0].load();
            }, 2000)
        },
        playMusic(type) {
            this.playClicked = !this.playClicked;
            const audio = $(`#${type}Track`);
            
            if (this.playClicked) {
                audio[0].play();
            } else {
                audio[0].pause();
            }
        },
        updateTime(project = false) {
            var audio;
            if (!project) {
                audio = $("#currentTrack")[0];
            } else {
                audio = $("#projectTrack")[0];
            }
            const minutes = Math.floor(audio.currentTime / 60);
            const seconds = Math.floor(audio.currentTime % 60);
            this.time = `${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
            if (!project) {
                const percentagePlayed = (audio.currentTime / audio.duration) * 100;
                $(".timeSlider").css("width", percentagePlayed + "%");
            }
        },
        handleAudioEnded(project = false) {
            this.playClicked = false;
            var audio;
            if (!project) {
                audio = $("#currentTrack")[0];
            } else {
                audio = $("#projectTrack")[0];
            }
            audio.currentTime = 0;
        },
        showList() {
            this.listShow = !this.listShow;
        },
        chooseTrack(index) {
            this.currentSong = songs[index];
            this.currentSongIndex = index;
            this.playClicked = false;
            this.listShow = false;
            $(".timeSlider").css("width", "0");
        },
        switchTrack(index) {
            this.currentSongIndex += index;
            if (this.currentSongIndex > this.songs.length - 1) {
                this.currentSongIndex = 0;
            }
            if (this.currentSongIndex < 0) {
                this.currentSongIndex = this.songs.length - 1;
            }
            this.currentSong = songs[this.currentSongIndex ];
            this.playClicked = false;
            this.listShow = false;
            $(".timeSlider").css("width", "0");
        },
        openProject(index, fromProjectSection = false) {
            if (fromProjectSection) {
                this.projectIndex += index;
            } else {
                this.projectIndex = index;
            }
            this.isLoading = true;
            this.projectSelected = this.projects[this.projectIndex];
            this.playClicked = false;
            this.time = "0:00";
            
            setTimeout(() => {
                this.page = "project";
                $("html, body").animate({
                    scrollTop: 0
                }, 100);
            }, 500)

            setTimeout(() => {
                this.isLoading = false;
                const audio = $("#projectTrack");
                audio.on("loadedmetadata", () => this.updateDuration(true));
                audio.on("timeupdate", () => this.updateTime(true));
                audio.on("ended", () => this.handleAudioEnded(true));
                audio[0].load();
            }, 2000)
        },
        contact() {
            var name = $("#name").val();
            var email = $("#email").val();
            var message = $("#message").val();

            const contactParams = {
                from_name: name,
                email: email,
                message: message,
            };
    
            emailjs.send("service_yuko1se", "template_djzp98g", contactParams)
                .then((response) => {
                    console.log("Email sent successfully!", response.status, response.text);
                    $("#name").val("");
                    $("#email").val("");
                    $("#message").val("");
                })
                .catch((error) => {
                    console.error("Failed to send email", error);
                });
        },
        subscribe() {
            var email = $("#userEmail").val();

            const subscribeParams = {
                email: email,
            };
    
            emailjs.send("service_yuko1se", "template_wr4vvja", subscribeParams)
                .then((response) => {
                    console.log("Subscription email sent successfully!", response.status, response.text);
                    $("#userEmail").val("");
                })
                .catch((error) => {
                    console.error("Failed to send subscription email", error);
                });
        },    
        showImage(index, fromModal = false) {
            if (fromModal) {
                const direction = index === 1 ? "slide-left" : "slide-right";
                $(".modalContent img").addClass(direction);
                setTimeout(() => {
                    $(".modalContent img").removeClass("slide-left slide-right");
                }, 600);
        
                this.imageIndex += index;
                if (this.imageIndex < 0) {
                    this.imageIndex = this.gallery.length - 1;
                }
                if (this.imageIndex == this.gallery.length) {
                    this.imageIndex = 0;
                }
            } else {
                this.imageIndex = index;
            }
            
            $("#modal img").attr("src", this.gallery[this.imageIndex]);
            this.showModal = true;
        },        
        closeModal() {
            this.showModal = false;
        },
        updateWindowWidth() {
            this.windowWidth = window.innerWidth;
        },
        scrollTop() {
            this.scrollPosition = $(window).scrollTop();
        },
        updateSectionOffsets() {
            this.sectionOffsets = {
                music: $("#music").offset().top - 55,
                videos: $("#videos").offset().top - 55,
                projects: $("#projects").offset().top - 55,
                biography: $("#biography").offset().top - 55,
                pictures: $("#pictures").offset().top - 55,
                contact: $("#contact").offset().top - 55,
            };
        },
        scrollFade() {
            if (this.scrollPosition >= this.sectionOffsets.videos) {
                this.videosFade = true;
            }
            if (this.scrollPosition >= this.sectionOffsets.projects) {
                this.projectsFade = true;
            }
            if (this.scrollPosition >= this.sectionOffsets.pictures) {
                this.picturesFade = true;
            }
        },
        parallaxEffect() {
            if (this.windowWidth > 767) {
                const scrollPosition = $(window).scrollTop();
                const parallaxSpeed = 0.3;
                const sections = [
                    { name: "videos", selector: "#videos .banBG" },
                    { name: "projects", selector: "#projects .banBG" },
                    { name: "biography", selector: "#biography .banBG" },
                    { name: "contact", selector: "#contact .banBG" }
                ];
        
                sections.forEach((section) => {
                    const sectionOffset = this.sectionOffsets[section.name];
                    if (section.name == "videos" || scrollPosition > (0.5 * sectionOffset)) {
                        const image = $(section.selector);
        
                        if (image.length) {
                            const imageOffset = (scrollPosition - (section.name === 'videos' ? 0 : sectionOffset)) * parallaxSpeed;
                            image.css("transform", `translate(-50%, -${imageOffset}px)`);
                        }
                    }
                });
            }
        },        
        handleMenu(event) {
            var menuList = $("header .mobile .fa-bars")[0];
            if (this.openMobileMenu && !menuList.contains(event.target)) {
                this.closeMenu();
            }
        },
    },
});

app.mount("#app");